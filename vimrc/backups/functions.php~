<?php
/**
 * Roots includes
 */
require_once locate_template('/lib/utils.php');           // Utility functions
require_once locate_template('/lib/init.php');            // Initial theme setup and constants
require_once locate_template('/lib/wrapper.php');         // Theme wrapper class
require_once locate_template('/lib/sidebar.php');         // Sidebar class
require_once locate_template('/lib/config.php');          // Configuration
require_once locate_template('/lib/activation.php');      // Theme activation
require_once locate_template('/lib/titles.php');          // Page titles
require_once locate_template('/lib/cleanup.php');         // Cleanup
require_once locate_template('/lib/nav.php');             // Custom nav modifications
require_once locate_template('/lib/gallery.php');         // Custom [gallery] modifications
require_once locate_template('/lib/comments.php');        // Custom comments modifications
require_once locate_template('/lib/rewrites.php');        // URL rewriting for assets
require_once locate_template('/lib/relative-urls.php');   // Root relative URLs
require_once locate_template('/lib/widgets.php');         // Sidebars and widgets
require_once locate_template('/lib/scripts.php');         // Scripts and stylesheets
require_once locate_template('/lib/custom.php');          // Custom functions

add_filter('show_admin_bar', '__return_false');

function register_my_menus() {
  register_nav_menus(
    array(
      'sections_navigation' => __( 'Sections Navigation' )
    )
  );
}
add_action( 'init', 'register_my_menus' );

register_sidebar(array(
  'name' => __( 'Unlock school widget' ),
  'id' => 'unlock-school-widget',
  'description' => __( 'Unlock school widget.')
));

function wpcf7_send_to_mailchimp($cfdata) {
	$lists = array(
		'wpcf7-f18-w2-o1' => '7c676e2d0a',
		'wpcf7-f20-w1-o1' => 'cdadb1fdb7',
		'wpcf7-f21-w3-o1' => '9ceb9880ea'
	);

	$formtitle = $cfdata->title;
	$formdata = $cfdata->posted_data;
	
	if($formdata["product-updates"] == ''){
		return;
	}

	$send_this_email = $formdata['your-email'];
	$tmp = split(' ', $formdata['your-name']);
	$mergeVars = array(
		'FNAME'=>$tmp[0],
		'LNAME'=>$tmp[1]
	);

// MCAPI.class.php needs to be in theme folder
	require_once('MCAPI.class.php');

// grab an API Key from http://admin.mailchimp.com/account/api/
	$api = new MCAPI('0638f0f20af50f73c88488b3cbce5ece-us7');

// grab your List's Unique Id by going to http://admin.mailchimp.com/lists/
// Click the "settings" link for the list - the Unique Id is at the bottom of that page.
	$list_id = $lists[$formdata['_wpcf7_unit_tag']];

// Send the form content to MailChimp List without double opt-in
	$retval = $api->listSubscribe($list_id, $send_this_email, $mergeVars, 'html', false);
}

add_action('wpcf7_mail_sent', 'wpcf7_send_to_mailchimp', 1);

add_filter('show_admin_bar', '__return_false');
