class PeopleController < ApplicationController

  def index
  end

  def create_account
    @account = Account.new(params.require(:account).permit!.merge(:in_school_id => current_user.school.id))
    @account.save
   ap @account.as_json 
   ap @account.errors
    respond_to do |format|
#      format.all { render :json => @account.save ? @account.as_json(:root => false) : { errors: @account.errors } }
      format.all {render :json => { errors: {} }}
    end
  end


  def upload
    @csv_upload = CsvUpload.new(
      school_id: current_user.school.id, 
      file: params[:file], 
      status: 'new',
      code: params[:code],
      password_handler: params[:password_handler],
      password_value: params[:password_value]
    )
    if saved = @csv_upload.save
      @accounts = @csv_upload.generate_accounts
    end
    respond_to do |f|
      f.all do
        if saved and @accounts
          render :json => @accounts
        else
          render :json => { :errors => @csv_upload.errors }
        end
      end
    end
  end
end
